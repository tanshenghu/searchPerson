define("widget/searchPerson/1.0.0/searchPerson",["$"],function(a,b,c){var d=a("$"),e=function(a){return"string"==typeof a&&(a={trigger:a}),a.trigger=d(a.trigger),a.type=a.type||"getJSON",a.params="object"!=typeof a.params?{}:a.params,this.options=a,this.curNode=null,this.init(),a.trigger};e.prototype={constructor:e,getPos:function(a){return a.offset().top+a.outerHeight(!0)+a.find(".dropDown").outerHeight(!0)>Math.max(document.documentElement.offsetHeight,document.body.offsetHeight)},eleInit:function(){this.options.trigger.each(function(){d(this).append('<div class="cinput"><input type="text"><var></var></div><div class="dropDown"></div>')}),this.getData(),this.options.remove===!0&&this.options.trigger.on("click",".J-del",function(){d(this).parent().remove()})},createInput:function(a){var b="";for(var c in a)this.options.field.name,b+='<input type="hidden" name="'+("name"==c?this.options.field.name||"name":"value"==c?this.options.field.value||"id":c)+'" value="'+a[c]+'">';return b},createChecked:function(a){if(!a.name)throw new TypeError('eg:{name:"zhangsan",value:"20"}');var b=this.curNode.parent(),c=b.prevAll(),d=this.options.url;this.options.alone===!0&&c.length||(d&&this.options.changeErr&&0==c.filter('[data-id="'+a.value+'"]').length?(this.curNode.parent().before('<div class="checked-items"'+(d?' data-id="'+a.value+'"':"")+'><var title="'+a.name+'">'+a.name+'</var><i class="J-del" title="删除">&times;</i>'+this.createInput(a)+"</div>"),this.curNode.val("").next().empty()):!d&&this.options.changeErr&&0==c.find('input[value="'+a.name+'"]').length?(this.curNode.parent().before('<div class="checked-items"'+(d?' data-id="'+a.value+'"':"")+'><var title="'+a.name+'">'+a.name+'</var><i class="J-del" title="删除">&times;</i><input type="hidden" name="'+(this.options.field.name||"name")+'" value="'+a.name+'"></div>'),this.curNode.val("").next().empty()):"function"==typeof this.options.changeErr&&this.options.changeErr.call(this.curNode,a,d?"Exist: id->"+a.value:"Exist: name->"+a.name))},getData:function(){var a,b=this,c="",e=b.options.url,f={};this.options.trigger.find(".cinput :text").on("keyup",function(g){var h=d(this),i=h.parent().next();if(b.curNode=h,c=h.val(),h.next().text(c),e)a=a||setTimeout(function(){f[b.options.field.kw||"keyword"]=h.val(),b.options.params=d.extend(b.options.params,f),d[b.options.type](e,b.options.params,function(a){if(a.success===!0||"true"===a.success){var c="function"==typeof b.options.renderList?b.options.renderList.call(i,b.options.params,a):"";i.html(c),c&&i.show()}},"JSON"),a=clearTimeout(a)},300);else if(13==g.keyCode||13==g.which||13==g.charCode||/;/g.test(c)){for(var j=c.split(/;/),k=0,l=j.length;l>k;k++)j[k]&&b.createChecked({name:j[k]});"function"==typeof b.options.change&&b.options.change.call(b.curNode,j)}}).on("keypress",function(){var a=d(this);a.next().text(a.val())}).on("blur",function(){var a=d(this);a.next().text(a.val())}).end().on("mousedown",function(a){return a.stopPropagation(),d(this).find(".cinput :text").focus(),!1}),e&&this.options.trigger.on("click",".dropDown a",function(){var a=d(this);"function"==typeof b.options.change&&b.createChecked(b.options.change.call(a)||{}),a.parent().hide()}),d(document).on("mousedown",function(){b.options.trigger.find(".dropDown").hide()})},init:function(){this.eleInit()}},c.exports=e});
